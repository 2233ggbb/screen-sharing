# 本地部署指南

当你没有远程服务器时，可以使用以下方案在本地运行 server 端。

## 方案对比

| 方案 | 适用场景 | 网络要求 | 难度 | 推荐度 |
|------|----------|----------|------|--------|
| 本地直接运行 | 同一局域网测试 | 局域网 | ⭐ | ⭐⭐⭐⭐⭐ |
| ngrok 内网穿透 | 临时远程测试 | 需要外网 | ⭐⭐ | ⭐⭐⭐⭐ |
| frp 内网穿透 | 长期远程使用 | 需要外网 | ⭐⭐⭐ | ⭐⭐⭐⭐ |
| Docker 本地部署 | 生产环境模拟 | 局域网 | ⭐⭐ | ⭐⭐⭐⭐ |
| Codespaces | 云端开发测试 | 需要外网 | ⭐ | ⭐⭐⭐ |

---

## 方案一：本地直接运行（最简单）⭐⭐⭐⭐⭐

### 适用场景
- 同一局域网内多设备测试
- 开发调试
- 演示 Demo

### 部署步骤

#### 1. 安装依赖并启动 server
```bash
# 进入 server 目录
cd server

# 安装依赖
npm install

# 启动开发服务器
npm run dev
```

服务器将在 `http://localhost:3000` 启动。

#### 2. 获取本机 IP 地址

**Windows：**
```powershell
ipconfig
# 查找 "IPv4 地址"，例如：192.168.1.100
```

**Mac/Linux：**
```bash
ifconfig
# 查找 "inet" 地址，例如：192.168.1.100
```

#### 3. 配置客户端

在客户端应用的设置页面，将服务器地址修改为：
```
http://你的IP地址:3000
```

例如：`http://192.168.1.100:3000`

#### 4. 启动客户端
```bash
cd client
npm install
npm run dev
```

### 优点
- ✅ 无需额外工具
- ✅ 完全免费
- ✅ 低延迟
- ✅ 适合开发调试

### 缺点
- ❌ 仅限局域网访问
- ❌ 需要保持电脑开机
- ❌ IP 地址可能变化

---

## 方案二：ngrok 内网穿透（推荐临时使用）⭐⭐⭐⭐

### 适用场景
- 远程演示
- 临时测试
- 快速分享

### 部署步骤

#### 1. 安装 ngrok
访问 [ngrok.com](https://ngrok.com/) 注册免费账号。

**Windows（PowerShell）：**
```powershell
# 使用 Chocolatey 安装
choco install ngrok

# 或者直接下载：https://ngrok.com/download
```

**Mac：**
```bash
brew install ngrok
```

#### 2. 配置 ngrok
```bash
# 设置 authtoken（从 ngrok 官网获取）
ngrok config add-authtoken <你的token>
```

#### 3. 启动 server
```bash
cd server
npm run dev
```

#### 4. 启动 ngrok 隧道
```bash
# 在新终端中运行
ngrok http 3000
```

你会看到类似输出：
```
Forwarding  https://abc123.ngrok-free.app -> http://localhost:3000
```

#### 5. 配置客户端

在客户端设置中，将服务器地址改为 ngrok 提供的 HTTPS 地址：
```
https://abc123.ngrok-free.app
```

### 优点
- ✅ 免费套餐可用
- ✅ 自动 HTTPS
- ✅ 支持外网访问
- ✅ 安装简单

### 缺点
- ❌ 免费版每次重启 URL 会变
- ❌ 可能有连接限制
- ❌ 需要保持 ngrok 运行

### 免费版限制
- 每次启动 URL 会变化
- 有访客提示页面
- 每月 40 连接小时限制

---

## 方案三：frp 内网穿透（长期使用）⭐⭐⭐⭐

### 适用场景
- 长期远程访问
- 固定域名需求
- 需要自定义配置

### 前置条件
- 需要一台有公网 IP 的服务器（用于运行 frps）
- 或者使用免费的 frp 服务提供商

### 部署步骤

#### 1. 下载 frp
访问 [GitHub Releases](https://github.com/fatedier/frp/releases) 下载对应版本。

**Windows：**
```powershell
# 下载并解压 frp_x.xx.x_windows_amd64.zip
```

#### 2. 配置 frpc.ini（客户端）
```ini
[common]
server_addr = 你的frp服务器地址
server_port = 7000

[screen-sharing]
type = tcp
local_ip = 127.0.0.1
local_port = 3000
remote_port = 6000
```

#### 3. 启动 server 和 frpc
```bash
# 终端 1：启动 server
cd server
npm run dev

# 终端 2：启动 frpc
./frpc -c frpc.ini
```

#### 4. 访问地址
```
http://你的frp服务器地址:6000
```

### 优点
- ✅ 固定域名/端口
- ✅ 高度可定制
- ✅ 稳定性好
- ✅ 支持多种协议

### 缺点
- ❌ 需要有公网 IP 服务器
- ❌ 配置相对复杂
- ❌ 需要运维经验

### 免费 frp 服务
- [Sakura Frp](https://www.natfrp.com/)
- [CHMLFRP](https://www.chmlfrp.cn/)

---

## 方案四：Docker 本地部署 ⭐⭐⭐⭐

### 适用场景
- 模拟生产环境
- 隔离测试环境
- 容器化部署

### 前置条件
安装 [Docker Desktop](https://www.docker.com/products/docker-desktop/)

### 部署步骤

#### 1. 构建 Docker 镜像
```bash
# 在项目根目录执行
cd server
npm run docker:build
```

#### 2. 运行容器
```bash
npm run docker:run
```

或者手动运行：
```bash
docker run -d \
  -p 3000:3000 \
  --name screen-sharing-server \
  screen-sharing-server:latest
```

#### 3. 查看日志
```bash
docker logs -f screen-sharing-server
```

#### 4. 停止容器
```bash
docker stop screen-sharing-server
docker rm screen-sharing-server
```

### 优点
- ✅ 环境一致性
- ✅ 易于迁移
- ✅ 资源隔离
- ✅ 便于管理

### 缺点
- ❌ 需要学习 Docker
- ❌ 占用额外资源
- ❌ 仍然仅限局域网

---

## 方案五：GitHub Codespaces ⭐⭐⭐

### 适用场景
- 临时测试
- 无本地环境
- 云端开发

### 部署步骤

#### 1. 创建 Codespace
1. 打开 GitHub 仓库
2. 点击 Code → Codespaces → Create codespace

#### 2. 启动 server
```bash
cd server
npm install
npm run dev
```

#### 3. 转发端口
Codespaces 会自动检测端口 3000 并提示转发。

#### 4. 获取公开 URL
在端口面板中，右键端口 3000 → 端口可见性 → Public

你会得到一个类似的 URL：
```
https://abc123-3000.app.github.dev
```

### 优点
- ✅ 无需本地环境
- ✅ 每月 60 小时免费
- ✅ 自动配置
- ✅ 支持外网访问

### 缺点
- ❌ 有使用时长限制
- ❌ 需要 GitHub 账号
- ❌ 可能有延迟

---

## 混合方案：本地 Server + 公网 Client

### 方案组合
使用 **本地运行 + ngrok** 的组合：

```bash
# 终端 1：启动 server
cd server
npm run dev

# 终端 2：启动 ngrok
ngrok http 3000

# 终端 3：启动 client（可选）
cd client
npm run dev
```

### 配置说明
- **局域网设备**：使用 `http://192.168.x.x:3000`
- **外网设备**：使用 ngrok 提供的 HTTPS URL

---

## 推荐选择

### 开发调试
**方案一：本地直接运行**
- 最简单，零成本
- 适合同一 WiFi 下多设备测试

### 远程演示
**方案二：ngrok**
- 快速，无需配置服务器
- 适合临时分享和演示

### 长期使用
**方案三：frp + 免费服务**
- 固定地址
- 适合持续开发

### 学习 Docker
**方案四：Docker 本地部署**
- 了解容器化部署
- 为后续云部署做准备

---

## 常见问题

### Q1: 如何在客户端切换服务器地址？
A: 在客户端主页点击"设置"按钮，修改"服务器地址"字段。

### Q2: ngrok 每次启动 URL 都变怎么办？
A: 升级到付费版（$8/月）获得固定域名，或使用 frp 方案。

### Q3: 防火墙拦截怎么办？
A: 在 Windows 防火墙中添加端口 3000 的入站规则：
```powershell
# PowerShell (管理员)
New-NetFirewallRule -DisplayName "Screen Sharing Server" -Direction Inbound -LocalPort 3000 -Protocol TCP -Action Allow
```

### Q4: 局域网访问不了怎么办？
A: 确保：
1. Server 和 Client 在同一网络
2. 防火墙已放行 3000 端口
3. IP 地址正确（不要用 localhost）

### Q5: 想要固定域名怎么办？
A: 
- 使用 ngrok 付费版
- 使用 frp + 自己的域名
- 部署到云服务器

---

## 下一步

选择适合你的方案后：

1. ✅ 按照步骤启动 server
2. ✅ 在客户端配置服务器地址
3. ✅ 测试连接和屏幕共享功能
4. 📚 查看 [开发指南](./开发指南.md) 了解更多

如需部署到生产环境，参考 [部署方案.md](./部署方案.md)。
