# Server 部署方案

## 问题分析

当前 server 使用 **Socket.io** 进行实时 WebRTC 信令通信，具有以下特点：
- 需要 WebSocket 长连接支持
- 需要有状态的服务器（房间、用户状态管理）
- 需要持久化进程

**Vercel Serverless Functions 的限制：**
- ❌ 不支持 WebSocket 长连接
- ❌ 无状态，每次请求是独立的
- ❌ 最大执行时间 10-60 秒
- ❌ 无法维持房间状态

## 推荐部署方案

### 方案一：Railway（推荐 ⭐⭐⭐⭐⭐）

**优点：**
- 原生支持 WebSocket
- 支持持久化进程
- 自动 SSL 证书
- 免费额度：每月 $5 免费额度
- 部署简单，一键部署

**部署步骤：**
```bash
# 1. 安装 Railway CLI
npm i -g @railway/cli

# 2. 登录
railway login

# 3. 初始化项目
cd server
railway init

# 4. 部署
railway up
```

### 方案二：Render（推荐 ⭐⭐⭐⭐）

**优点：**
- 免费套餐支持 WebSocket
- 自动 SSL
- GitHub 自动部署

**部署步骤：**
1. 在 render.com 创建账号
2. 新建 Web Service
3. 连接 GitHub 仓库
4. 配置：
   - Root Directory: `server`
   - Build Command: `npm install && npm run build`
   - Start Command: `npm start`

### 方案三：Fly.io（推荐 ⭐⭐⭐⭐）

**优点：**
- 全球边缘部署
- 支持 WebSocket
- 免费套餐

**部署步骤：**
```bash
# 1. 安装 flyctl
brew install flyctl

# 2. 登录
flyctl auth login

# 3. 初始化
cd server
flyctl launch

# 4. 部署
flyctl deploy
```

### 方案四：使用 Vercel + 第三方 WebSocket 服务（混合方案）

如果一定要用 Vercel，可以：
- Vercel 部署静态 API
- 使用 **Ably** 或 **Pusher** 作为实时通信层
- 需要重构代码

**不推荐原因：** 需要大量代码重构，增加复杂性

## 选择建议

| 方案 | 难度 | 成本 | 推荐度 |
|------|------|------|--------|
| Railway | ⭐ | 免费/$5/月 | ⭐⭐⭐⭐⭐ |
| Render | ⭐ | 免费 | ⭐⭐⭐⭐ |
| Fly.io | ⭐⭐ | 免费 | ⭐⭐⭐⭐ |
| Vercel + Ably | ⭐⭐⭐⭐⭐ | 付费 | ⭐ |

## 我的推荐

**使用 Railway 部署**，原因：
1. 支持 WebSocket，无需改代码
2. 部署最简单
3. 免费额度足够开发测试
4. 支持自定义域名
