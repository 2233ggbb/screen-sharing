# 多人屏幕共享项目 - 目录结构规划

## 整体项目结构

```
screen-sharing/
├── client/                 # 客户端（Electron应用）
├── server/                 # 服务端（Node.js信令服务器）
├── shared/                 # 客户端和服务端共享的代码
├── docs/                   # 项目文档
├── plans/                  # 规划文档
├── README.md              # 项目说明
└── package.json           # 根项目配置
```

## 客户端目录结构（client/）

```
client/
├── src/
│   ├── main/              # Electron主进程
│   │   ├── index.ts       # 主进程入口
│   │   ├── window.ts      # 窗口管理
│   │   ├── ipc/           # IPC通信处理
│   │   │   ├── screen-capture.ts  # 屏幕捕获IPC
│   │   │   └── app-control.ts     # 应用控制IPC
│   │   └── utils/         # 主进程工具函数
│   │
│   ├── renderer/          # Electron渲染进程（前端界面）
│   │   ├── pages/         # 页面组件
│   │   │   ├── Home/      # 首页（加入/创建房间）
│   │   │   ├── Room/      # 房间页面
│   │   │   └── Settings/  # 设置页面
│   │   │
│   │   ├── components/    # 可复用组件
│   │   │   ├── VideoGrid/        # 视频网格布局
│   │   │   ├── ScreenSelector/   # 屏幕/窗口选择器
│   │   │   ├── UserList/         # 用户列表
│   │   │   ├── ChatPanel/        # 聊天面板（可选）
│   │   │   └── Controls/         # 控制栏
│   │   │
│   │   ├── services/      # 业务服务
│   │   │   ├── webrtc/    # WebRTC相关
│   │   │   │   ├── peer-connection.ts  # P2P连接管理
│   │   │   │   ├── stream-manager.ts   # 流管理
│   │   │   │   └── signaling.ts        # 信令处理
│   │   │   │
│   │   │   ├── socket/    # Socket.io客户端
│   │   │   │   └── client.ts           # WebSocket连接
│   │   │   │
│   │   │   └── screen/    # 屏幕捕获
│   │   │       └── capture.ts          # 屏幕捕获逻辑
│   │   │
│   │   ├── store/         # 状态管理（如Zustand/Redux）
│   │   │   ├── room.ts    # 房间状态
│   │   │   ├── user.ts    # 用户状态
│   │   │   └── stream.ts  # 流状态
│   │   │
│   │   ├── hooks/         # 自定义React Hooks
│   │   │   ├── useWebRTC.ts
│   │   │   ├── useSocket.ts
│   │   │   └── useScreenShare.ts
│   │   │
│   │   ├── utils/         # 工具函数
│   │   │   ├── logger.ts
│   │   │   └── constants.ts
│   │   │
│   │   ├── styles/        # 样式文件
│   │   │   ├── global.css
│   │   │   └── variables.css
│   │   │
│   │   ├── App.tsx        # 应用根组件
│   │   └── index.tsx      # 渲染进程入口
│   │
│   └── preload/           # Electron预加载脚本
│       └── index.ts       # 预加载脚本（暴露安全的API到渲染进程）
│
├── public/                # 静态资源
│   ├── icons/             # 应用图标
│   └── index.html         # HTML模板
│
├── build/                 # 构建配置
│   ├── icons/             # 打包用图标
│   └── entitlements.mac.plist  # macOS权限配置
│
├── dist/                  # 编译输出（gitignore）
├── package.json
├── tsconfig.json
├── electron-builder.json  # Electron打包配置
└── vite.config.ts         # Vite构建配置
```

## 服务端目录结构（server/）

```
server/
├── src/
│   ├── index.ts           # 服务入口
│   │
│   ├── config/            # 配置
│   │   ├── default.ts     # 默认配置
│   │   └── index.ts       # 配置导出
│   │
│   ├── controllers/       # 控制器
│   │   ├── room.controller.ts    # 房间控制器
│   │   └── user.controller.ts    # 用户控制器
│   │
│   ├── services/          # 业务逻辑
│   │   ├── room.service.ts       # 房间管理服务
│   │   ├── signaling.service.ts  # 信令服务
│   │   └── user.service.ts       # 用户管理服务
│   │
│   ├── socket/            # Socket.io事件处理
│   │   ├── index.ts       # Socket初始化
│   │   ├── handlers/      # 事件处理器
│   │   │   ├── room.handler.ts      # 房间事件
│   │   │   ├── webrtc.handler.ts    # WebRTC信令事件
│   │   │   └── connection.handler.ts # 连接事件
│   │   │
│   │   └── middleware/    # Socket中间件
│   │       └── auth.middleware.ts   # 认证中间件
│   │
│   ├── models/            # 数据模型
│   │   ├── Room.ts        # 房间模型
│   │   ├── User.ts        # 用户模型
│   │   └── Stream.ts      # 流模型
│   │
│   ├── types/             # TypeScript类型定义
│   │   ├── socket.types.ts
│   │   ├── room.types.ts
│   │   └── user.types.ts
│   │
│   ├── utils/             # 工具函数
│   │   ├── logger.ts      # 日志工具
│   │   ├── validation.ts  # 数据验证
│   │   └── id-generator.ts # ID生成
│   │
│   └── middleware/        # Express中间件
│       ├── error.middleware.ts    # 错误处理
│       └── cors.middleware.ts     # CORS配置
│
├── tests/                 # 测试文件
│   ├── unit/
│   └── integration/
│
├── logs/                  # 日志文件（gitignore）
├── dist/                  # 编译输出（gitignore）
├── package.json
├── tsconfig.json
└── nodemon.json           # 开发热重载配置
```

## 共享代码目录（shared/）

```
shared/
├── src/
│   ├── types/             # 共享类型定义
│   │   ├── events.ts      # Socket事件类型
│   │   ├── messages.ts    # 消息类型
│   │   └── common.ts      # 通用类型
│   │
│   ├── constants/         # 共享常量
│   │   ├── events.ts      # 事件名称常量
│   │   ├── errors.ts      # 错误码常量
│   │   └── config.ts      # 配置常量
│   │
│   └── utils/             # 共享工具函数
│       └── validators.ts  # 验证函数
│
├── package.json
└── tsconfig.json
```

## 文档目录（docs/）

```
docs/
├── PRD.md                 # 产品需求文档
├── 技术架构设计.md        # 技术架构文档
├── API文档.md             # API接口文档
├── 部署运维文档.md        # 部署运维指南
├── 开发指南.md            # 开发指南
└── assets/                # 文档资源
    └── diagrams/          # 架构图等
```

## 关键文件说明

### 客户端关键文件

- **`src/main/index.ts`**: Electron主进程入口，负责创建窗口、处理系统事件
- **`src/renderer/services/webrtc/peer-connection.ts`**: WebRTC核心逻辑，管理P2P连接
- **`src/renderer/services/screen/capture.ts`**: 使用Electron API捕获屏幕/窗口
- **`src/preload/index.ts`**: 安全地暴露主进程功能到渲染进程

### 服务端关键文件

- **`src/index.ts`**: 服务器启动入口，初始化Express和Socket.io
- **`src/socket/handlers/webrtc.handler.ts`**: 处理WebRTC信令（offer、answer、ICE）
- **`src/services/room.service.ts`**: 房间管理核心逻辑，维护房间状态
- **`src/services/signaling.service.ts`**: 信令转发服务，协调P2P连接

### 共享关键文件

- **`shared/src/constants/events.ts`**: 定义所有Socket事件名称，确保客户端和服务端一致
- **`shared/src/types/events.ts`**: 定义所有事件的payload类型

## 技术栈对应

| 目录 | 技术栈 |
|------|--------|
| client/src/main | Electron主进程 + TypeScript |
| client/src/renderer | React + TypeScript + Vite |
| client/src/renderer/services/webrtc | WebRTC API |
| server | Node.js + Express + Socket.io + TypeScript |
| shared | TypeScript |

## 构建产物

- **客户端**: `client/dist/` → 打包后的Electron应用（.dmg、.exe、.AppImage）
- **服务端**: `server/dist/` → 编译后的Node.js代码
